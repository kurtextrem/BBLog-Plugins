/*! Extended friendlist v1.3.23 | (c) 2014 Kurtextrem, Pun1a | CC BY-NC-ND 3.0 http://creativecommons.org/licenses/by-nc-nd/3.0/deed.de */
+function(a,b){b.handle("add.plugin",{id:"extended-friends-plugin",name:"Extended Friendlist",version:"1.3.23",translations:{en:{"fix.exp":"EXP Event Banner Fix","fix.exp.tooltip":"Fixes the EXP Event banner, to better fit the main page.","fix.showAll":"Show 'All' everytime in the Game Activity window.",firstStepText1:"Extended Friendlist Information",firstStepText2:"Welcome!",firstStepText3:"In order to add someone to the extended friendlist visit his profile and press the yellow 'Add to ext. friendlist' button.",firstStepText4:"The extended friendlist is displayed below the offline friendlist.",firstStepText5:"If you want to refresh the list, press the refresh button next to the search button in the 'COM Center' line.",firstStepText6:"Please report bugs in the BBL Forum.",firstStepText7:"New in this version:",firstStepText8:"Fix for new Battlelog. See wrong nicknames in the FL.",buttonTooltip:"Add this player to your extended friendlist.",buttonRemoveTooltip:"Remove this player from your extended friendlist.",refreshTooltip:"Last update:",showFriends:"Show Friends",away:"Away",remove:"Remove!",unknown:"Unknown."},de:{"fix.exp":"EXP Event Banner Fix","fix.exp.tooltip":"Ver\xe4ndert den Event Banner, damit weniger Platz beansprucht wird.","fix.showAll":"Immer 'Alles' anzeigen in der Spiel Aktivit\xe4t.",firstStepText1:"Erweiterte Freundesliste Informationen",firstStepText2:"Willkommen!",firstStepText3:"Um jemanden zu deiner erweiterten Freundesliste hinzuzuf\xfcgen, musst du sein Profil besuchen und den gelben 'Add to ext. friendlist' klicken.",firstStepText4:"Die erweiterte Freundesliste ist unter der Offline Freundesliste.",firstStepText5:"Wenn du die erweiterte Freundesliste aktualisieren willst, musst du das aktualisieren Icon in neben dem Suche Icon in der 'COM Center' Zeile dr\xfccken.",firstStepText6:"Melde Fehler bitte im Forum.",firstStepText7:"Neu in dieser Version:",firstStepText8:"Funktionsf\xe4hig nach Battlelog Update. Falsche Namen sind in der Liste sichtbar.",buttonTooltip:"Spieler zur erweiterten Freundesliste hinzuf\xfcgen.",buttonRemoveTooltip:"Spieler von der erweiterten Freundesliste entfernen.",refreshTooltip:"Letzte Aktualisierung:",showFriends:"Freunde anzeigen",away:"Abwesend",remove:"Entfernen!",unknown:"Unbekannt."},pt:{"fix.exp":"Ajuste do Banner Evendo de Experi\xeancia Dobrada","fix.exp.tooltip":"Ajusta o Banner Evento de Experi\xeancia Dobrada para melhor pagina\xe7\xe3o.","fix.showAll":"Mostrar 'TUDO' na janela de Atividade de Jogo.",firstStepText1:"Informa\xe7\xe3o da Lista Estendida de Amigos",firstStepText2:"Bem-vindo!",firstStepText3:"Para adicionar amigos \xe0 sua lista estendida acesse o perfil requerido e clique em 'Ad. \xe0 lista estendida'.",firstStepText4:"A lista estendida \xe9 mostrada abaixo da lista de amigos offline.",firstStepText5:"Se desejar atualizar a lista pressione o bot\xe3o 'Atualizar' pr\xf3ximo \xe0 caixa de procura",firstStepText6:"Por favor, reporte erros no F\xf3rum do BBLog",firstStepText7:"O que h\xe1 de novo:",firstStepText8:"Ajuste ao novo Battlelog ao mostrar nome errados na lista estendida.",buttonTooltip:"Adicione este soldado \xe0 lista estendida",buttonRemoveTooltip:"Remover este soldado da lista estendida",refreshTooltip:"\xdaltima Atualiza\xe7\xe3o:",showFriends:"Mostrar Amigos",away:"Ocupado",remove:"Remover!",unknown:"Desconhecido."}},configFlags:[["fix.exp",1],["fix.showAll",1],["showFriends",1,function(a){a.showFriends()}]],instance:{},extendedFriends:[],optedOut:["l_like_Chocolate"],htmlCache:"",lastupdate:0,updating:!1,languageAddition:"",init:function(c){this.instance=c,this.languageAddition="en"===b.cache("language")?"":"/"+b.cache("language"),this.extendedFriends=this.instance.storage("plugin.extendedfriends")||[],this.htmlCache=window.localStorage["extfriends.htmlCache"]||"",this.lastUpdate=window.localStorage["extfriends.lastUpdate"]||0,(a.now()-this.lastUpdate)/1e3>120&&(this.htmlCache=""),this.handler(),this.addRefreshButton(),this.addAjaxListener(),""==this.htmlCache&&(this.addSeparator(),this.addList());var e=(a("#comcenter-offline-separator"),"FirstStep111"),f=a(".main-loggedin-leftcolumn-activity-filter");window.setTimeout(function(){f.find("li:first-of-type").hasClass("selected")&&c.storage("fix.showAll")&&f.find("li:last-of-type").click()},1e3),c.storage(e)||this.alert("welcomealert",this.instance.t("firstStepText1")+" v"+this.version,"<strong>"+this.instance.t("firstStepText2")+"</strong><p>"+this.instance.t("firstStepText3")+"</p><p>"+this.instance.t("firstStepText4")+"</p><p>"+this.instance.t("firstStepText5")+"</p><p>"+this.instance.t("firstStepText6")+"</p><p><strong>"+this.instance.t("firstStepText7")+"</strong> "+this.instance.t("firstStepText8")+"</p>",function(){c.storage(e,!0)})},domchange:function(){this.handler()},handler:function(){var c=a("html"),d="bf4"===b.cache("mode")?".user-container .username span":".username > h1",e=c.find(d).first().length,f=c.find("#comcenter-extfl-separator").length;1===e&&(e=c.find("#extendedFriendsButton").length,0===e&&this.addButton()),0===f&&(a("#comcenter-offline-separator").parent().after(this.htmlCache),a("#comcenter-tab-friends-content").jScrollPane({horizontalgutter:-7,verticalgutter:-7}),this.updating?this.spinner(!0):a("#comcenterExtFlFriends > span").append("<i> -Cache-</i>")),this.instance.storage("fix.exp")&&(a(".main-loggedin-premium-scoremultiplier").css("position","absolute").css("right",0),a("#main-loggedin-premium-scoremultiplier-icon").css("top","5px"))},addbutton:function(){var c=a('<span class="bblog-button" id="extendedFriendsButton" data-tooltip="'+this.instance.t("buttonTooltip")+'" style="position:absolute;top:15px;white-space:nowrap;left:100%;margin-left:5%">Add to ext. friendlist</span>'),d=window.location.href.match(/\/user\/([^\/]+)/)[1],e="#profile-header .interact";this.isOptedOut(d)||(-1!==this.extendedFriends.indexOf(d)&&c.text("Remove from ext. friendlist").attr("data-tooltip",this.instance.t("buttonRemoveTooltip")),"bf4"===b.cache("mode")&&(e=".user-container .interact .box-content",c.removeClass(".bblog-button").addClass("btn btn-primary btn-tiny"),c.css("position","static")),a(e).append(c),c.click(function(){this.toggleName(d)}.bind(this)))},togglename:function(a,b){this.extendedFriends=this.instance.storage("plugin.extendedfriends")||[];var c=this.extendedFriends.indexOf(a);-1===c?this.extendedFriends.push(a):this.extendedFriends.splice(c,1),this.instance.storage("plugin.extendedfriends",this.extendedFriends),b||this.refresh()},refresh:function(){a("#extendedFriendsButton").remove(),a("#comcenter-extfl-separator").parent().remove(),a(".extFlPlaying, .extFlOnline").remove(),this.addSeparator(),this.addList()},addlist:function(){if(!this.updating){var c=this.extendedFriends.length;c>0&&(this.spinner(!0),this.updating=!0),a(this.extendedFriends).each(function(d,e){var f=e,g=this.languageAddition+"/bf"+("bf4"===b.cache("mode")?"4":"3")+"/user/"+f;a.ajax(g,{type:"GET",headers:{"X-AjaxNavigation":1},success:function(a){if(!a||!a.context||"undefined"==typeof a.context.profileCommon)return this.buildTemplate(f);if(a.context.profileCommon.user.presence.isOnline){var b=a.context.profileCommon,c=a.globalContext.profileUserId,e="",h="http://www.gravatar.com/avatar/"+b.user.gravatarMd5+"?s=36&d=http%3A%2F%2Fbattlelog-cdn.battlefield.com%2Fcdnprefix%2Favatar1%2Fpublic%2Fbase%2Fshared%2Fdefault-avatar-36.png";if(("undefined"!=typeof b.user.presence.isAway||65537===typeof b.user.presence.presenceState)&&(e=this.instance.t("away")),"undefined"!=typeof b.user.presence.isPlaying&&"undefined"!=typeof b.user.presence.playingMp){var i=b.user.presence.playingMp.serverGuid,j=b.user.presence.playingMp.serverName,k=b.user.presence.playingMp.game,l=this.languageAddition+"/bf"+(2048===k?"4":"3")+"/servers/show/pc/"+i+"/",m=b.user.presence.playingMp.platform,n=b.user.presence.playingMp.personalId;return this.buildTemplate(f,c,g,h,!1,"",!0,k,m,j,l,i,n)}return this.buildTemplate(f,c,g,h,e)}}.bind(this),error:function(){this.buildTemplate(f)}.bind(this)}).done(function(){d===c-1&&window.setTimeout(function(){this.updating=!1,this.spinner(!1),this.lastUpdate=a.now(),window.localStorage["extfriends.lastUpdate"]=this.lastUpdate,a("#comcenter-tab-friends-content").jScrollPane({horizontalgutter:-7,verticalgutter:-7})}.bind(this),1e3)}.bind(this))}.bind(this)),a(document).on("click",".removeExtFl",function(b){var c=a(b.target);c.parents(".comcenter-friend").fadeOut(5e3),this.toggleName(c.data("nick"),!0),b.preventDefault()}.bind(this))}},buildtemplate:function(b,c,d,e,f,g,h,i,j,k,l,m,n){var o="",p="",q="",r="",s="",t="online";return"undefined"==typeof c&&(c=a.now(),d="#",e="http://battlelog-cdn.battlefield.com/cdnprefix/avatar1/public/base/shared/default-avatar-36.png",f=this.instance.t("remove"),g='style="background-color:rgba(255,0,0,.55)"',o=!0),"undefined"==typeof h&&(h=""),f&&(q='<div class="comcenter-username-away">'+f+"</div>",o&&(q='<div class="comcenter-username-away"><span class="bblog-button tiny removeExtFl" data-nick="'+b+'">'+f+"</span></div>"),f=" comcenter-username-idle"),h&&(f="",r=" comcenter-friend-playing",t="playing",null===l&&null===k&&(l="#",k=this.instance.t("unkown")),q='<div class="comcenter-username-serverinfo origin-game-title"><span class="common-gameicon-hori bright common-game-'+i+"-"+j+' comcenter-game-icon"></span><span class="common-playing-link" data-track="friend.playing.server.link"><a title="'+k+'" class="common-playing-link comcenter-playing-link" href="'+l+'">'+k+"</a></span></div>",2048===i&&(s=" btn-primary"),h='<button class="btn btn-small join-friend-submit-link join-friend join-friendcomcenter-interact-playing'+s+'" data-bind-action="join-mp-gameserver" data-role="1" data-guid="'+m+'" data-game="'+i+'" data-platform="1" data-friendpersonaid="'+n+'" data-track="friend.playing.server.join"><i class="icon-join-friend"></i></button></div>'),"undefined"==typeof g&&(g=""),p='<surf:container id="comcenter-surface-friends_'+c+'" class="extFLFriend"><li id="comcenter-'+c+'" class="comcenter-friend-item comcenter-friend comcenter-friend-online'+r+'" rel="'+c+'"'+g+'><div class="comcenter-avatar"><a href="'+d+'"><i class="avatar medium '+t+'" style="background-image:url('+e+')"></i></a></div><div class="comcenter-usernam	e'+f+'"><a class="comcenter-username-link" href="'+d+'">'+unescape(b)+"</a>"+q+'</div><div class="comcenter-interact-container">'+h+"</li></surf:container>",""!==h?this.addHTML(".extFlPlaying",p):this.addHTML(".extFlOnline",p)},addhtml:function(b,c,d){var b=a(b);d?b.after(c):b.append(c);var c=a(".extFlOnline").parent().html();return null===c?this.refresh():(c="<div>"+c+"</div>",this.addCache(this.addSeparator(!0)+c))},addcache:function(a){return this.htmlCache=a,window.localStorage["extfriends.htmlCache"]=a},addRefreshbutton:function(){var b=a("#extFLRefresh");"undefined"==typeof b[0]&&(b=a('<img id="extFLRefresh" src="http://kurtextrem.de/bbl/refresh.png" style="position:absolute;top:10px;right:4px;cursor:pointer">'),b.load(function(){a("#friendlist-header > i").before(b)}.bind(this)).click(function(){(a.now()-this.lastUpdate)/1e3>4&&this.refresh()}.bind(this)).hover(function(){this.updateRefreshTitle(b)}.bind(this)))},updateRefreshtitle:function(b){var c=(a.now()-this.lastUpdate)/1e3;b.attr("title",this.instance.t("refreshTooltip")+" "+Math.floor(c,1)+"s ")},addseparator:function(a){var b='<surf:container id="comcenterOnlineFriends"><li id="comcenter-extfl-separator" class="comcenter-separator online"><surf:container id="comcenterExtFlFriends"><span style="cursor:default">Ext. Friendlist</span></surf:container></li></surf:container>';return a?b:(b+='<div><div class="extFlPlaying"></div><div class="extFlOnline"></div></div>',this.addHTML('[id^="comcenter-surface-friends_"]:last-of-type',b),void 0)},showfriends:function(){var f,c="",d=this.extendedFriends.length,e="";c+='<table style="border:0;width:50%;margin:auto">';for(var g=0;d>g;g++)c+="<tr>",e=this.extendedFriends[g],c+="<td>",c+='<a href="http://battlelog.battlefield.com'+this.languageAddition+"/bf"+("bf4"===b.cache("mode")?"4":"3")+"/user/"+e+'/">'+unescape(e)+"</a> ",c+="</td>",c+="<td>",c+='<span data-nick="'+e+'"  style="cursor:pointer" title="'+this.instance.t("remove")+'">(X)</span>',c+="</td>",c+="</tr>";c+="</table>",this.alert("friendsalert",this.instance.t("firstStepText1")+" v"+this.version,c,function(){a("#extFLRefresh").click()}),f=a("#popup-friendsalert"),f.find(".common-popup-content-container").css({overflow:"auto",height:"382px"}),f.find("td > span").click(function(b){var c=a(b.target);c.parents("tr").fadeOut(5e3),this.toggleName(c.data("nick"),!0)}.bind(this))},spinner:function(b){return b?a("#comcenterExtFlFriends").append('<span class="loader small extFlSpinner" style="margin-left:7px"></span>'):a(".extFlSpinner").remove()},addAjaxlistener:function(){a(document).on("click","#popup-friendsalert a, .extFLFriend a",function(b){Surface.ajaxNavigation.navigateTo(a(this).attr("href")),b.preventDefault()})},isoptedout:function(a){return-1!==this.optedOut.indexOf(a)},alert:function(c,d,e,f){var g=a('<div class="popup-prompt-buttons"><div style="text-align:right"><input type="button" class="ok-btn base-button-arrow-small popup-prompt-button-continue" value="'+b.t("ok")+'"/><div class="base-clear"></div></div>');f||(f=function(){}),e="<div>"+e+"</div>",g.find(".common-popup-close-button").on("click",function(){f(null),b.closeAllPopups()}),g.find(".ok-btn").on("click",function(){f(!0),b.closeAllPopups()}),b.popup(c,d,e,g)}})}(jQuery,BBlog);
